<!DOCTYPE html>
<html lang="ar" dir="rtl">
<head>
  <meta charset="UTF-8">
  <title>لعبة المعادلات - خطوة بخطوة</title>
  <meta name="viewport" content="width=device-width, initial-scale=1">
  <style>
    :root {
      --primary: #4f46e5;
      --success: #22c55e;
      --error: #ef4444;
      --bg: #f9fafb;
      --card: #ffffff;
      --text: #111827;
    }
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: 'Cairo', sans-serif; }
    body { background: var(--bg); color: var(--text); display: flex; flex-direction: column; min-height: 100vh; align-items: center; padding: 2rem; }
    header { width: 100%; max-width: 600px; text-align: center; margin-bottom: 1.5rem; }
    #progress-bar { height: 8px; background: #e5e7eb; border-radius: 4px; overflow: hidden; margin-bottom: 1rem; }
    #progress-fill { height: 100%; background: var(--primary); width: 0%; transition: width 0.3s; }
    #game-area { background: var(--card); border-radius: 12px; box-shadow: 0 4px 14px rgba(0,0,0,.05); padding: 2rem; width: 100%; max-width: 600px; text-align: center; }
    #equation-svg { width: 100%; height: 120px; margin-bottom: 1.5rem; }
    .btn { background: var(--primary); color: #fff; border: none; padding: 0.75rem 1.5rem; border-radius: 8px; font-size: 1rem; cursor: pointer; margin: 0.5rem; transition: background 0.2s; }
    .btn:hover { background: #4338ca; }
    #hint-box { margin-top: 1rem; font-size: 0.9rem; color: #6b7280; }
    footer { margin-top: 2rem; font-size: 0.8rem; color: #9ca3af; }
    
    /* إضافات CSS للوحدات */
    .tile-group { display: inline-flex; align-items: center; gap: 0.5rem; }
    .tile { display: inline-block; width: 50px; height: 50px; border-radius: 8px; font-size: 24px; line-height: 50px; text-align: center; }
    .box  { background: #f97316; color: #fff; font-weight: bold; }      /* x */
    .ball { background: #3b82f6; color: #fff; border-radius: 50%; }     /* عدد */
    .op   { font-size: 28px; margin: 0 0.25rem; }
    .equals { font-size: 32px; margin: 0 1rem; }
    
    /* إضافات السحب والإفلات */
    .draggable { cursor: grab; transition: transform 0.2s; }
    .draggable:active { cursor: grabbing; transform: scale(1.05); }
    .drop-zone { min-height: 60px; border: 2px dashed #cbd5e1; border-radius: 8px; display: flex; align-items: center; justify-content: center; margin: 0.5rem 0; }
    .drop-zone.highlight { border-color: var(--primary); background: #eef2ff; }
    
    /* تأثيرات UX */
    @keyframes pulse {
      0%   { transform: scale(1); }
      50%  { transform: scale(1.08); background: var(--success); }
      100% { transform: scale(1); }
    }
    .correct-drop { animation: pulse 0.4s ease; }
    .hidden-value { filter: blur(3px) grayscale(1); transition: filter 0.4s; }
    .revealed     { filter: none; }
  </style>
</head>
<body>
  <header>
    <h1>لعبة المعادلات</h1>
    <div id="progress-bar"><div id="progress-fill"></div></div>
  </header>

  <main id="game-area">
    <svg id="equation-svg" viewBox="0 0 600 120">
      <!-- النص الأصلي مخفي -->
      <text id="equation-text" x="300" y="70" font-size="28" text-anchor="middle" fill="#111" style="display:none;">2x + 3 = 7</text>
    </svg>
    
    <div id="equation-visual" style="display: flex; justify-content: center; gap: 0.5rem; align-items: center; margin-bottom: 1rem;">
      <!-- المناطق الجانبية -->
      <div class="drop-zone" id="left-zone" data-side="left"></div>
      <span class="equals">=</span>
      <div class="drop-zone" id="right-zone" data-side="right"></div>
    </div>

    <div id="workspace" style="margin-bottom: 1rem;">
      <!-- العناصر القابلة للسحب -->
    </div>

    <button class="btn" id="next-step-btn">الخطوة التالية</button>
    <button class="btn" id="reset-btn" style="display:none;">إعادة التشغيل</button>
    <div id="hint-box">ابدأ بالضغط على "الخطوة التالية" لحل المعادلة.</div>
  </main>

  <footer>تم تطويره بواسطة ترس الشفرة-1</footer>

  <script>
    // --- المتغيرات العامة ---
    let currentLevel = 0;
    const levels = [
      {
        equation: "2x + 3 = 7",
        left:  [{ type: "box", label: "🟧", value: "x", count: 2 }, { type: "ball", label: "🔵", value: "+3", count: 1 }],
        right: [{ type: "ball", label: "🔵", value: "7", count: 1 }],
        steps: ["اسحب 🔵 من اليسار إلى اليمين لتصبح سالبة", "ثم اقسم على 🟧×2"]
      },
      {
        equation: "3x - 4 = 2x + 1",
        left:  [{ type: "box", label: "🟧", value: "x", count: 3 }, { type: "ball", label: "🔵", value: "-4", count: 1 }],
        right: [{ type: "box", label: "🟧", value: "x", count: 2 }, { type: "ball", label: "🔵", value: "+1", count: 1 }],
        steps: ["اسحب 🟧×2 من اليمين إلى اليسار", "اسحب 🔵-4 من اليسار إلى اليمين", "اقسم على 1"]
      }
    ];

    const leftZone   = document.getElementById('left-zone');
    const rightZone  = document.getElementById('right-zone');
    const workspace  = document.getElementById('workspace');
    const hintBox    = document.getElementById('hint-box');
    const nextBtn    = document.getElementById('next-step-btn');
    const resetBtn   = document.getElementById('reset-btn');
    const progressFill = document.getElementById('progress-fill');

    let step = 0;
    let dragged = null;

    // --- دوال اللعبة ---
    function createDraggable(item) {
      const el = document.createElement('span');
      el.className = 'tile draggable hidden-value';
      el.draggable = true;
      if (item.type === 'box') {
        el.classList.add('box');
        el.textContent = item.label;
        el.dataset.value = item.value;
        el.title = item.value;
      } else {
        el.classList.add('ball');
        el.textContent = item.label;
        el.dataset.value = item.value;
        el.title = item.value;
      }
      el.dataset.type = item.type;
      el.addEventListener('dragstart', e => dragged = e.target);
      return el;
    }

    function renderLevel(index) {
      const level = levels[index];
      workspace.innerHTML = '';
      leftZone.innerHTML = '';
      rightZone.innerHTML = '';

      // ملء المناطق بالعناصر
      level.left.forEach(item => {
        for (let i = 0; i < item.count; i++) {
          leftZone.appendChild(createDraggable(item));
        }
      });

      level.right.forEach(item => {
        for (let i = 0; i < item.count; i++) {
          rightZone.appendChild(createDraggable(item));
        }
      });

      hintBox.textContent = level.steps[0];
      progressFill.style.width = `${((index + 1) / levels.length) * 100}%`;
      step = 0;
      nextBtn.style.display = 'none';
      resetBtn.style.display = 'none';
    }

    // إعداد مناطق الإفلات
    [leftZone, rightZone].forEach(zone => {
      zone.addEventListener('dragover', e => e.preventDefault());
      zone.addEventListener('dragenter', () => zone.classList.add('highlight'));
      zone.addEventListener('dragleave', () => zone.classList.remove('highlight'));
      zone.addEventListener('drop', e => {
        e.preventDefault();
        if (dragged) {
          zone.classList.remove('highlight');
          zone.appendChild(dragged);
          dragged.classList.add('correct-drop');
          setTimeout(() => dragged.classList.remove('correct-drop'), 400);
          
          // تشغيل صوت خافت
          playTone(600, 0.1);
          
          checkStep();
        }
      });
    });

    function checkStep() {
      const level = levels[currentLevel];
      step++;
      if (step < level.steps.length) {
        hintBox.textContent = level.steps[step];
      } else {
        hintBox.textContent = "✅ تم حل المعادلة بنجاح!";
        nextBtn.style.display = 'inline-block';
      }
    }

    nextBtn.addEventListener('click', () => {
      if (currentLevel < levels.length - 1) {
        currentLevel++;
        renderLevel(currentLevel);
      } else {
        hintBox.textContent = "🏆 أحسنت! أنهيت جميع المستويات!";
        nextBtn.style.display = 'none';
        resetBtn.style.display = 'inline-block';
      }
    });

    resetBtn.addEventListener('click', () => {
      renderLevel(0);
      nextBtn.style.display = 'none';
      resetBtn.style.display = 'none';
    });

    // --- تحسينات UX: الصوت والمؤثرات ---
    const audioCtx = new (window.AudioContext || window.webkitAudioContext)();
    function playTone(freq = 600, duration = 0.1) {
      try {
        const osc = audioCtx.createOscillator();
        const gain = audioCtx.createGain();
        osc.type = 'sine';
        osc.frequency.value = freq;
        gain.gain.setValueAtTime(0.1, audioCtx.currentTime);
        gain.gain.exponentialRampToValueAtTime(0.0001, audioCtx.currentTime + duration);
        osc.connect(gain);
        gain.connect(audioCtx.destination);
        osc.start();
        osc.stop(audioCtx.currentTime + duration);
      } catch (e) {
        console.log("الصوت غير مدعوم في هذا المتصفح");
      }
    }

    function revealValues() {
      document.querySelectorAll('.hidden-value').forEach(el => {
        el.addEventListener('click', () => {
          el.classList.toggle('revealed');
          playTone(800, 0.05);
        });
      });
    }

    // --- تهيئة اللعبة ---
    renderLevel(0);
    revealValues();
  </script>
</body>
</html>
